<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Standalone Mode Clustering (TCP) :: Red Hat JBoss EAP Administration II</title>
    <link rel="prev" href="standalone-cluster-udp.html">
    <link rel="next" href="load-balancing.html">
    <meta name="generator" content="Antora 3.1.3">
    <link rel="stylesheet" href="../../../_/css/site.css">
    <script>var uiRootPath = '../../../_'</script>
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://www.redhat.com" target="_blank"><img
          src="../../../_/img/redhat-logo.png"
          height="40px"
          alt="Red Hat"
        /></a>
      <a
        class="navbar-item"
        style="font-size: 24px; color: white"
        href="../../.."
      >Red Hat JBoss EAP Administration II</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a
          class="navbar-item"
          href="https://github.com/RedHatQuickCourses/eap-admin2/issues"
          target="_blank"
        >Report Issues</a>
      </div>
    </div>
  </nav>
</header><div class="body">
<div class="nav-container" data-component="eap-admin2" data-version="8">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../index.html">Red Hat JBoss EAP Administration II</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../index.html">Home</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../adv-install/index.html">Advanced Installation</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../adv-install/response-files.html">Automated Installer Script</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../adv-install/adv-patching.html">Patches and Updates</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../domain/index.html">JBoss EAP Domain Mode</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../domain/domain-mode.html">JBoss EAP Domain Mode Configuration</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../domain/domain-deployment.html">Deploying Applications</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../domain/jvm-config.html">JVM Configuration</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="index.html">Clustering and High Availability</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="standalone-cluster-udp.html">Standalone Mode Clustering (UDP)</a>
  </li>
  <li class="nav-item is-current-page" data-depth="2">
    <a class="nav-link" href="standalone-cluster-tcp.html">Standalone Mode Clustering (TCP)</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="load-balancing.html">Load Balancing JBoss EAP Instances</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../security/index.html">Securing EAP</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../security/eap-security.html">Enabling or Disabling the EAP Management (Web) Console</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../security/tls-console.html">Enabling TLS/SSL in the EAP Web Console</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../security/vault.html">Secure Credential Storage Using Elytron Credential Store</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../security/sso-console.html">EAP Web Console Single Sign-On using OIDC</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Red Hat JBoss EAP Administration II</span>
    <span class="version">8</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <a class="title" href="../index.html">Red Hat JBoss EAP Administration II</a>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="../index.html">8</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../index.html">Red Hat JBoss EAP Administration II</a></li>
    <li><a href="index.html">Clustering and High Availability</a></li>
    <li><a href="standalone-cluster-tcp.html">Standalone Mode Clustering (TCP)</a></li>
  </ul>
</nav>
</div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">Standalone Mode Clustering (TCP)</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>By default, the tcp stack also uses multicast to discover other cluster members by using the MPING JGroups protocol. JGroups provides other discovery protocols, such as PING, TCPPING, TCPGOSSSIP, JDBC_PING, FILE_PING, DNS_PING, or KUBE_PING. See the references section to learn more about each discovery protocol.</p>
</div>
<div class="paragraph">
<p>If you need to avoid multicast communication, then you can customize the tcp stack by changing the discovery protocol to either TCPPING or TCPGOSSIP.</p>
</div>
<div class="paragraph">
<p><strong>TCPPING</strong> is a JGroups protocol that uses a static list to define the cluster members, and uses unicast as an alternative to multicast.</p>
</div>
<div class="paragraph">
<p>The following parameters are specific to this protocol:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>initial_hosts</strong> - A list of the hosts to look up for cluster membership.</p>
</li>
<li>
<p><strong>port_range</strong> - The range that the protocol uses to search for hosts based on the initial port. For example, a port range of two on an initial port of 7600 results in the TCPPING protocol searching for a viable host on ports 7600 and 7601.</p>
</li>
<li>
<p><strong>TCPGOSSIP</strong> - Discovers members of a cluster by using an external gossip router.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In this section, we focus on TCP based clustering using the TCPPING protocol and a static list of initial hosts that lists the cluster members.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_references"><a class="anchor" href="#_references"></a>References</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="https://access.redhat.com/documentation/en-us/red_hat_jboss_enterprise_application_platform/7.4/html/configuration_guide/configuring_high_availability#switch_default_jgroups_channel_tcp">Configuring TCP based clustering in JBoss EAP</a></p>
</li>
<li>
<p><a href="https://access.redhat.com/solutions/46373">Cluster Testing Application</a></p>
</li>
<li>
<p><a href="https://access.redhat.com/solutions/195283">Testing JBoss EAP replication without load balancers or web servers</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_exercise_clustering_jboss_eap_8_instances_in_standalone_mode_tcp"><a class="anchor" href="#_exercise_clustering_jboss_eap_8_instances_in_standalone_mode_tcp"></a>Exercise: Clustering JBoss EAP 8 instances in Standalone Mode (TCP)</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_pre_requisites"><a class="anchor" href="#_pre_requisites"></a>Pre-requisites</h3>
<div class="ulist">
<ul>
<li>
<p>For the exercises in this chapter, you will need <strong>two (2)</strong> servers or VMs with JBoss EAP 8.0 installed on them. Your IP addresses maybe different. Replace the values according to your set up.</p>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Host</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>IP Address</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Role</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>eap1.example.com</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>192.168.124.11</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Cluster Node</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>eap2.example.com</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>192.168.124.12</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Cluster Node</code></p></td>
</tr>
</tbody>
</table>
</li>
<li>
<p>Install JBoss EAP 8.0 on both servers. We recommend using the zip file installation method and installing it in a separate directory to prevent overwriting the configuration of the instance that you have used in previous exercises. For all VMs, create a user named <code>jboss</code> that will run the JBoss EAP instance.</p>
</li>
</ul>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
This chapter and the following chapters involve a lot changes to the XML configuration files in JBoss EAP. We recommend you backup the configuration files after each exercise so that you have a record of your changes.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_steps"><a class="anchor" href="#_steps"></a>Steps</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>You need to open a number of firewall ports on the <code>eap1</code> and <code>eap2</code> RHEL 9 VMs for clustering to work. Use the script below to configure the firewall. Execute the script/commands as the <code>root</code> user:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">#!/bin/sh

# UDP ports
firewall-cmd --permanent --zone=public --add-port=23364/udp
firewall-cmd --permanent --zone=public --add-port=45688/udp
firewall-cmd --permanent --zone=public --add-port=45700/udp
firewall-cmd --permanent --zone=public --add-port=55200/udp

# TCP ports
firewall-cmd --permanent --zone=public --add-port=7600/tcp
firewall-cmd --permanent --zone=public --add-port=54200/tcp
firewall-cmd --permanent --zone=public --add-port=57600/tcp
firewall-cmd --permanent --zone=public --add-port=8080/tcp
firewall-cmd --permanent --zone=public --add-port=8009/tcp

firewall-cmd --reload</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can verify that the ports are open using the command below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">[root@server]# firewall-cmd --list-all --zone=public
public (active)
  target: default
  icmp-block-inversion: no
  interfaces: enp1s0
  sources:
  services: cockpit dhcpv6-client ssh
  ports: 23364/udp 45688/udp 45700/udp 55200/udp 54200/tcp 7600/tcp 57600/tcp 8080/tcp 8009/tcp
  protocols:
  forward: yes
  masquerade: no
  forward-ports:
  source-ports:
  icmp-blocks:
  rich rules:</code></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Ensure you run these commands on <strong>BOTH</strong> <code>eap1</code> and <code>eap2</code> cluster nodes!
</td>
</tr>
</table>
</div>
</li>
<li>
<p>JBoss EAP conveniently provides a number of useful default configuration files for high availability setups. For this exercise, we will use the <code>standalone-full-ha.xml</code> configuration file for clustering, high availability and load balancing. Inspect the <code>jgroups</code> subsystem in the <code>$JBOSS_HOME/standalone/configuration/standalone-full-ha.xml</code> file:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;subsystem xmlns="urn:jboss:domain:jgroups:9.0"&gt;
  &lt;channels default="ee"&gt;
    &lt;channel name="ee" stack="udp" cluster="ejb"/&gt;
  &lt;/channels&gt;
  &lt;stacks&gt;
    &lt;stack name="udp"&gt;
      ...
    &lt;/stack&gt;
    &lt;stack name="tcp"&gt;
      ...
    &lt;/stack&gt;
    &lt;/stacks&gt;
&lt;/subsystem&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>JBoss EAP uses the <strong>jgroups</strong> subsystem for forming clusters. The jgroups subsystem can work with different types of networks (UDP and TCP) to handle cluster communication. By default, <strong>UDP</strong> is used for cluster communication.</p>
</div>
</li>
<li>
<p>Start the <code>eap1</code> node as the <code>jboss</code> user.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">[jboss@eap1 bin] $ ./standalone.sh -c standalone-full-ha.xml \
  -Djboss.bind.address=192.168.124.11 \
  -Djboss.bind.address.private=192.168.124.11 \
  -Djboss.node.name=eap1 \
  -Djboss.messaging.cluster.password=redhat123</code></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Each node of the cluster must have a unique name. Use the <code>-Djboss.node.name</code> flag in the command line to pass a unique name.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Note that in our environment, we are binding both the <code>-Djboss.bind.address</code> and <code>-Djboss.bind.address.private</code> values to the same IP address (The IP address of the respective VMs). Ideally, you should use separate network interfaces with different IPs in separate isolated sub-networks.
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Start the <code>eap2</code> node as the <code>jboss</code> user. Pass the IP address and unique node name of the cluster member as command line flags.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">[jboss@eap1 bin] $ ./standalone.sh -c standalone-full-ha.xml\
  -Djboss.bind.address=192.168.124.12 \
  -Djboss.bind.address.private=192.168.124.12 \
  -Djboss.node.name=eap2 \
  -Djboss.messaging.cluster.password=redhat123</code></pre>
</div>
</div>
</li>
<li>
<p>To configure clustering using the TCP stack, download and inspect the JBoss EAP CLI file at <a href="https://github.com/RedHatQuickCourses/eap-qc-apps/blob/main/admin2/new-tcp-stack.cli" class="bare">https://github.com/RedHatQuickCourses/eap-qc-apps/blob/main/admin2/new-tcp-stack.cli</a>. Copy this file to both <code>eap1</code> and <code>eap2</code>.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash"># Define the socket bindings
/socket-binding-group=standard-sockets/remote-destination-outbound-socket-binding=jgroups-host-eap1:add(host=192.168.124.11,port=7600)
/socket-binding-group=standard-sockets/remote-destination-outbound-socket-binding=jgroups-host-eap2:add(host=192.168.124.12,port=7600)
batch
# Add the tcpping stack
/subsystem=jgroups/stack=tcpping:add
/subsystem=jgroups/stack=tcpping/transport=TCP:add(socket-binding=jgroups-tcp)
/subsystem=jgroups/stack=tcpping/protocol=TCPPING:add(socket-bindings=[jgroups-host-eap1,jgroups-host-eap2])
/subsystem=jgroups/stack=tcpping/protocol=MERGE3:add
/subsystem=jgroups/stack=tcpping/protocol=FD_SOCK:add
/subsystem=jgroups/stack=tcpping/protocol=FD_ALL:add
/subsystem=jgroups/stack=tcpping/protocol=VERIFY_SUSPECT:add
/subsystem=jgroups/stack=tcpping/protocol=pbcast.NAKACK2:add
/subsystem=jgroups/stack=tcpping/protocol=UNICAST3:add
/subsystem=jgroups/stack=tcpping/protocol=pbcast.STABLE:add
/subsystem=jgroups/stack=tcpping/protocol=pbcast.GMS:add
/subsystem=jgroups/stack=tcpping/protocol=MFC:add
/subsystem=jgroups/stack=tcpping/protocol=FRAG3:add
# Set tcpping as the stack for the ee channel
/subsystem=jgroups/channel=ee:write-attribute(name=stack,value=tcpping)
run-batch
reload</code></pre>
</div>
</div>
<div class="paragraph">
<p>We create <code>socket-bindings</code> for every node in the cluster and give it a unique name, IP address and port number where cluster communication happens. Replace the IP address values as per your environment. We also a new jgroups <code>TCPPING</code> stack, that uses the TCP protocol to communicate with cluster members. We finally set the default jgroups stack to the newly created TCPPING stack.</p>
</div>
</li>
<li>
<p>Execute the <code>new-tcp-stack.cli</code> file on <strong>BOTH</strong> <code>eap1</code> and <code>eap2</code> using the EAP CLI and pass the path to the CLI file.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">[jboss@eap1 bin]$ ./jboss-cli.sh --connect --file=/tmp/new-tcp-stack.cli
{"outcome" =&gt; "success"}
{"outcome" =&gt; "success"}
The batch executed successfully
process-state: reload-required
[jboss@eap1 bin]$ :reload</code></pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Ensure you execute this script on BOTH <code>eap1</code> and <code>eap2</code> nodes!
</td>
</tr>
</table>
</div>
</li>
<li>
<p>You can inspect the difference in the <code>standalone-full-ha.xml</code> file after you execute this script on both nodes. See <a href="https://github.com/RedHatQuickCourses/eap-qc-apps/blob/main/admin2/tpc-udp.diff" class="bare">https://github.com/RedHatQuickCourses/eap-qc-apps/blob/main/admin2/tpc-udp.diff</a>.</p>
</li>
<li>
<p>Download the sample application to test the cluster from <a href="https://github.com/RedHatQuickCourses/eap-qc-apps/releases/download/eap8-lp/cluster.war" class="bare">https://github.com/RedHatQuickCourses/eap-qc-apps/releases/download/eap8-lp/cluster.war</a>. Copy the WAR file to the <code>/tmp</code> folder on both <code>eap1</code> and <code>eap2</code>.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ scp cluster.war jboss@eap1:/tmp/
$ scp cluster.war jboss@eap2:/tmp/</code></pre>
</div>
</div>
</li>
<li>
<p>Launch the JBoss EAP CLI and deploy the WAR file on both <code>eap1</code> and <code>eap2</code> nodes.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">[jboss@eap1 bin]$ ./jboss-cli.sh --connect
[standalone@localhost:9990 /] deploy /tmp/cluster.war --force</code></pre>
</div>
</div>
<div class="paragraph">
<p>Repeat the same commands to deploy the WAR file on <code>eap2</code>.</p>
</div>
</li>
<li>
<p>Access the test application on <code>eap1</code>. Using a web browser, navigate to the public IP of <code>eap1</code> (<a href="http://192.168.124.11:8080/cluster" class="bare">http://192.168.124.11:8080/cluster</a>). You should see the home page of the application. It prints the session ID value along with a simple counter that increments on every page hit. It also shows which node servers the request (This will become relevant when you introduce a load balancer in the next section and split the traffic between the two nodes).</p>
<div class="imageblock">
<div class="content">
<img src="_images/cluster-app-browser.png" alt="Cluster Test App in Browser">
</div>
</div>
</li>
<li>
<p>The idea behind clustering is to replicate the HTTP session objects between the cluster nodes. Since there is no load balancer running with <em>session stickiness</em> enabled, we need to test it manually from the command line using the <code>curl</code> command and passing the session value as HTTP header (as cookies) values. JBoss EAP creates a unique cookie for every user (called <strong>JSESSIOND</strong>), that it uses to track HTTP sessions. Open the browser&#8217;s DevTools pane (Ctrl + Shift + C for Chrome, then go to <code>Application &gt; Cookies &gt; <a href="http://192.168.124.11:8080" class="bare">http://192.168.124.11:8080</a></code>) and find the <strong>JSESSIONID</strong> cookie value. Right click on the value, select <code>Edit Value</code>, and then copy this value to the clipboard.</p>
<div class="imageblock">
<div class="content">
<img src="_images/jsession-id-value.png" alt="Grab the JSESSIONID Cookie Value from DevTools">
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
You cannot use a browser to test this scenario because there is no way to enable or simulate session stickiness. The browser will create a unique session ID for each of the nodes and you will not be able to visualize the replication and failover.
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Use the <code>curl</code> command to send requests to the application and increment the counter. Replace the <code>Cookie:</code> value with your own unique <strong>JSESSIONID</strong> value.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ curl http://192.168.124.11:8080/cluster/cluster \
  --header "Cookie: JSESSIONID=HxM_z7c2tbtHdpzo0JnYkV5jNZWEfHvxrP0-bja-.eap1"
...
&lt;h1&gt;Cluster Demo App&lt;/h1&gt;
&lt;p&gt;Session ID: ohWxpNiozUE7xG9q3cGIAmkthrsRdtf8EJrZwntg&lt;/p&gt;
&lt;p&gt;Visit Count: 2&lt;/p&gt;
&lt;p&gt;I am running on host eap1.example.com (192.168.124.11)&lt;/p&gt;
...</code></pre>
</div>
</div>
<div class="paragraph">
<p>Run this <code>curl</code> command a few more times and observe the <code>Visit Count</code> value increasing by one for every request.</p>
</div>
</li>
<li>
<p>The session ID created on <code>eap1</code> should have been replicated to all members of the cluster. To verify this behavior, press <code>Ctrl + C</code> in the <code>eap1</code> terminal window to stop the <code>eap1</code> node and eject it from the cluster. Observe the logs in the terminal window on <code>eap2</code>. The cluster has noticed that <code>eap1</code> is no longer available and it rebalances.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">...
ISPN100001: Node eap1 left the cluster
ISPN100007: After merge (or coordinator change), recovered members [eap2]...
...</code></pre>
</div>
</div>
</li>
<li>
<p>Use the <code>curl</code> command to send requests to <code>eap2</code>. Replace the <code>Cookie:</code> value with the same <strong>JSESSIONID</strong> value that you used for sending requests to <code>eap1</code>.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ curl http://192.168.124.12:8080/cluster/cluster \
  --header "Cookie: JSESSIONID=HxM_z7c2tbtHdpzo0JnYkV5jNZWEfHvxrP0-bja-.eap1"
&lt;h1&gt;Cluster Demo App&lt;/h1&gt;
&lt;p&gt;Session ID: ZFf88oPFpFjtMX12TEbVuPJCHDpPO4Dcrj9rm4_6&lt;/p&gt;
&lt;p&gt;Visit Count: 3&lt;/p&gt;
&lt;p&gt;I am running on host eap2.example.com (192.168.124.12)&lt;/p&gt;</code></pre>
</div>
</div>
</li>
<li>
<p>Observe how the counter value is incremented, and not reset to zero. This is because the counter value (which has been stored in the HTTP session) has been replicated to <code>eap2</code>. Send a few more requests and notice the counter value is incremented by 1 for every request.</p>
</li>
<li>
<p>Optional: Test failback. First, restart <code>eap1</code> and let it join the cluster. Now, kill <code>eap2</code> and re-test the cluster application using curl, but this time send requests to <code>eap1</code>. Observe that the counter value is not reset, instead it is incremented by one as expected.</p>
</li>
</ol>
</div>
</div>
</div>
</div>
<nav class="pagination">
  <span class="prev"><a href="standalone-cluster-udp.html">Standalone Mode Clustering (UDP)</a></span>
  <span class="next"><a href="load-balancing.html">Load Balancing JBoss EAP Instances</a></span>
</nav>
</article>
  </div>
</main>
</div>
<footer class="footer">
  <img src="../../../_/img/rhl-logo-red.png" height="40px" alt="Red Hat"  href="https://redhat.com" >
</footer><script id="site-script" src="../../../_/js/site.js" data-ui-root-path="../../../_"></script>
<script async src="../../../_/js/vendor/highlight.js"></script>
  </body>
</html>
