<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Standalone Mode Clustering (UDP) :: Red Hat JBoss EAP Administration II</title>
    <link rel="prev" href="index.html">
    <link rel="next" href="domain-cluster.html">
    <meta name="generator" content="Antora 3.1.3">
    <link rel="stylesheet" href="../../../_/css/site.css">
    <script>var uiRootPath = '../../../_'</script>
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://www.redhat.com" target="_blank"><img
          src="../../../_/img/redhat-logo.png"
          height="40px"
          alt="Red Hat"
        /></a>
      <a
        class="navbar-item"
        style="font-size: 24px; color: white"
        href="../../.."
      >Red Hat JBoss EAP Administration II</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a
          class="navbar-item"
          href="https://github.com/RedHatQuickCourses/eap-admin2/issues"
          target="_blank"
        >Report Issues</a>
      </div>
    </div>
  </nav>
</header><div class="body">
<div class="nav-container" data-component="eap-admin2" data-version="8">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../index.html">Red Hat JBoss EAP Administration II</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../index.html">Home</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../adv-install/index.html">Advanced Installation</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../adv-install/response-files.html">Automated Installer Script</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../adv-install/adv-patching.html">Patches and Updates</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../domain/index.html">JBoss EAP Domain Mode</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../domain/domain-mode.html">JBoss EAP Domain Mode Configuration</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../domain/domain-deployment.html">Deploying Applications</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../domain/jvm-config.html">JVM Configuration</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="index.html">Clustering and High Availability</a>
<ul class="nav-list">
  <li class="nav-item is-current-page" data-depth="2">
    <a class="nav-link" href="standalone-cluster.html">Standalone Mode Clustering (UDP)</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="domain-cluster.html">Domain Mode Clustering</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="load-balancing.html">Load Balancing JBoss EAP Instances</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../security/index.html">Security</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../security/eap-security.html">EAP Security</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../security/sso.html">Single Sign-On using OIDC</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../openshift/index.html">EAP on OpenShift</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../openshift/eap-container.html">EAP Container</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../openshift/deploy-openshift.html">Deploy EAP Applications on OpenShift</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Red Hat JBoss EAP Administration II</span>
    <span class="version">8</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <a class="title" href="../index.html">Red Hat JBoss EAP Administration II</a>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="../index.html">8</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../index.html">Red Hat JBoss EAP Administration II</a></li>
    <li><a href="index.html">Clustering and High Availability</a></li>
    <li><a href="standalone-cluster.html">Standalone Mode Clustering (UDP)</a></li>
  </ul>
</nav>
</div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">Standalone Mode Clustering (UDP)</h1>
<div class="sect1">
<h2 id="_references"><a class="anchor" href="#_references"></a>References</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="https://access.redhat.com/documentation/en-us/red_hat_jboss_enterprise_application_platform/7.4/html/configuration_guide/configuring_high_availability#intro_to_ha">Configuring High Availability in JBoss EAP</a></p>
</li>
<li>
<p><a href="https://access.redhat.com/solutions/46373">Cluster Testing Application</a></p>
</li>
<li>
<p><a href="https://access.redhat.com/solutions/195283">Testing JBoss EAP replication without load balancers or web servers</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_exercise_clustering_jboss_eap_8_instances_in_standalone_mode_udp"><a class="anchor" href="#_exercise_clustering_jboss_eap_8_instances_in_standalone_mode_udp"></a>Exercise: Clustering JBoss EAP 8 instances in Standalone Mode (UDP)</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_pre_requisites"><a class="anchor" href="#_pre_requisites"></a>Pre-requisites</h3>
<div class="ulist">
<ul>
<li>
<p>For the exercises in this chapter, you will need <strong>three (3)</strong> servers or VMs with JBoss EAP 8.0 installed on them. Your IP addresses maybe different. Replace the values according to your set up.</p>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Host</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>IP Address</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Role</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>controller.example.com</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>192.168.124.10</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Load Balancer</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>eap1.example.com</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>192.168.124.11</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Cluster Node</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>eap2.example.com</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>192.168.124.12</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Cluster Node</code></p></td>
</tr>
</tbody>
</table>
</li>
<li>
<p>Install JBoss EAP 8.0 on all three servers. We recommend using the zip file installation method and installing it in a separate directory to prevent overwriting the configuration of the instance that you have used in previous exercises. For all three VMs, create a user named <code>jboss</code> that will run the JBoss EAP instance.</p>
</li>
</ul>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
This chapter and the following chapters involve a lot changes to the XML configuration files in JBoss EAP. We recommend you backup the configuration files after each exercise so that you have a record of your changes.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_steps"><a class="anchor" href="#_steps"></a>Steps</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>You need to open a number of firewall ports on the <code>eap1</code> and <code>eap2</code> RHEL 9 VMs for clustering to work. Use the script below to configure the firewall. Execute the script/commands as the <code>root</code> user:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">#!/bin/sh

# UDP ports
firewall-cmd --permanent --zone=public --add-port=23364/udp
firewall-cmd --permanent --zone=public --add-port=45688/udp
firewall-cmd --permanent --zone=public --add-port=45700/udp
firewall-cmd --permanent --zone=public --add-port=55200/udp

# TCP ports
firewall-cmd --permanent --zone=public --add-port=7600/tcp
firewall-cmd --permanent --zone=public --add-port=54200/tcp
firewall-cmd --permanent --zone=public --add-port=57600/tcp
firewall-cmd --permanent --zone=public --add-port=8080/tcp

firewall-cmd --reload</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can verify that the ports are open using the command below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">[root@server]# firewall-cmd --list-all --zone=public
public (active)
  target: default
  icmp-block-inversion: no
  interfaces: enp1s0
  sources:
  services: cockpit dhcpv6-client ssh
  ports: 8080/tcp 8230/tcp 23364/udp 45688/udp 45700/udp 55200/udp 54200/tcp 7600/tcp 57600/tcp
  protocols:
  forward: yes
  masquerade: no
  forward-ports:
  source-ports:
  icmp-blocks:
  rich rules:</code></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Ensure you run these commands on <strong>BOTH</strong> <code>eap1</code> and <code>eap2</code> cluster nodes!
</td>
</tr>
</table>
</div>
</li>
<li>
<p>JBoss EAP conveniently provides a number of useful default configuration files for high availability setups. For the exercises in this chapter, we will use the <code>standalone-full-ha.xml</code> configuration file for clustering, high availability and load balancing. Inspect the <code>jgroups</code> subsystem in the <code>$JBOSS_HOME/standalone/configuration/standalone-full-ha.xml</code> file:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;subsystem xmlns="urn:jboss:domain:jgroups:9.0"&gt;
  &lt;channels default="ee"&gt;
    &lt;channel name="ee" stack="udp" cluster="ejb"/&gt;
  &lt;/channels&gt;
  &lt;stacks&gt;
    &lt;stack name="udp"&gt;
      ...
    &lt;/stack&gt;
    &lt;stack name="tcp"&gt;
      ...
    &lt;/stack&gt;
    &lt;/stacks&gt;
&lt;/subsystem&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>JBoss EAP uses the <strong>jgroups</strong> subsystem for forming clusters. The jgroups subsystem can work with different types of networks (UDP and TCP) to handle cluster communication. By default, <strong>UDP</strong> is used for cluster communication. This is for performance reasons and the fact that you do not need to explicitly configure the nodes in a cluster. EAP nodes can join or leave a cluster and the cluster auto-discovers the cluster members and re-configures itself automatically.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Only use UDP multi-casting based clusters if you have full control of your network. In this setup, you can start any number of EAP nodes in the same subnet and they will all automatically discover each other and form a cluster!. Many corporate environments and the public clouds will <em>disable</em> multicasting in their networks, and this UDP based set up will not work. In such cases, you need to configure jgroups to use the <strong>TCP</strong> stack. This is covered in the next section.
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Inspect the <code>socket-binding-group</code> configuration in the <code>standalone-full-ha.xml</code> file:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;socket-binding-group name="standard-sockets" default-interface="public" port-offset="${jboss.socket.binding.port-offset:0}"&gt;
  ...
  &lt;socket-binding name="jgroups-mping" interface="private" multicast-address="${jboss.default.multicast.address:230.0.0.4}" multicast-port="45700"/&gt;
  &lt;socket-binding name="jgroups-tcp" interface="private" port="7600"/&gt;
  &lt;socket-binding name="jgroups-tcp-fd" interface="private" port="57600"/&gt;
  &lt;socket-binding name="jgroups-udp" interface="private" port="55200" multicast-address="${jboss.default.multicast.address:230.0.0.4}" multicast-port="45688"/&gt;
  &lt;socket-binding name="jgroups-udp-fd" interface="private" port="54200"/&gt;
  ...
&lt;/socket-binding-group&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note how the <code>interface</code> used for cluster communication is <code>private</code>. Cluster communication between nodes happens on a separate network interface (usually bound to a separate private network), while the regular application traffic flows in to the cluster via its <code>public</code> interface. The ports used in this snippet correspond to the firewall ports you opened in the previous steps. The default multi-cast address is <strong>230.0.0.4</strong>.</p>
</div>
</li>
<li>
<p>Start the <code>eap1</code> node as the <code>jboss</code> user.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">[jboss@eap1 bin] $ ./standalone.sh -c standalone-full-ha.xml \
  -Djboss.bind.address=192.168.124.11 \
  -Djboss.bind.address.private=192.168.124.11 \
  -Djboss.node.name=eap1 \
  -Djboss.messaging.cluster.password=redhat123</code></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Each node of the cluster must have a unique name. Use the <code>-Djboss.node.name</code> flag in the command line to pass a unique name.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Note that in our environment, we are binding both the <code>-Djboss.bind.address</code> and <code>-Djboss.bind.address.private</code> values to the same IP address (The IP address of the respective VMs). Ideally, you should use separate network interfaces with different IPs in separate isolated sub-networks.
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Start the <code>eap2</code> node as the <code>jboss</code> user. Pass the IP address and unique node name of the cluster member as command line flags.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">[jboss@eap1 bin] $ ./standalone.sh -c standalone-full-ha.xml\
  -Djboss.bind.address=192.168.124.12 \
  -Djboss.bind.address.private=192.168.124.12 \
  -Djboss.node.name=eap2 \
  -Djboss.messaging.cluster.password=redhat123</code></pre>
</div>
</div>
</li>
<li>
<p>Observe the terminal on the <code>eap1</code> node where you started the JBoss EAP instance. The cluster detects that a new node <code>eap2</code> has joined the cluster.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">... ISPN100000: Node eap2 joined the cluster
...
... ISPN100002: Starting rebalance with members [eap1, eap2] ...
... Finished rebalance with members [eap1, eap2], topology id 2
...</code></pre>
</div>
</div>
</li>
<li>
<p>Download the sample application to test the cluster from <a href="https://github.com/RedHatQuickCourses/eap-qc-apps/releases/download/eap8-lp/cluster.war" class="bare">https://github.com/RedHatQuickCourses/eap-qc-apps/releases/download/eap8-lp/cluster.war</a>. Copy the WAR file to the <code>/tmp</code> folder on both <code>eap1</code> and <code>eap2</code>.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ scp cluster.war jboss@eap1:/tmp/
$ scp cluster.war jboss@eap2:/tmp/</code></pre>
</div>
</div>
</li>
<li>
<p>Launch the JBoss EAP CLI and deploy the WAR file on both <code>eap1</code> and <code>eap2</code> nodes.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">[jboss@eap1 bin]$ ./jboss-cli.sh --connect
[standalone@localhost:9990 /] deploy /tmp/cluster.war</code></pre>
</div>
</div>
<div class="paragraph">
<p>Repeat the same commands to deploy the WAR file on <code>eap2</code>.</p>
</div>
</li>
<li>
<p>Verify that the WAR file has been deployed on both nodes by observing the logs in the terminal windows where you started the two nodes:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">... WFLYDR0001: Content added at ...
... WFLYSRV0027: Starting deployment of "cluster.war" (runtime-name: "cluster.war")
...
... WFLYCLINF0002: Started cluster.war cache from web container
... WFLYUT0021: Registered web context: '/cluster' for server 'default-server'
... WFLYSRV0010: Deployed "cluster.war" (runtime-name : "cluster.war")</code></pre>
</div>
</div>
</li>
<li>
<p>Access the test application on <code>eap1</code>. Using a web browser, navigate to the public IP of <code>eap1</code> (<a href="http://192.168.124.11:8080/cluster" class="bare">http://192.168.124.11:8080/cluster</a>). You should see the home page of the application. It prints the session ID value along with a simple counter that increments on every page hit. It also shows which node servers the request (This will become relevant when you introduce a load balancer in the next section and split the traffic between the two nodes).</p>
</li>
<li>
<p>The idea behind clustering is to replicate the HTTP session objects between the cluster nodes. Since there is no load balancer running with <em>session stickiness</em> enabled, we need to test it manually from the command line using the <code>curl</code> command and passing the session value as HTTP header (as cookies) values. JBoss EAP creates a unique cookie for every user (called <strong>JSESSIOND</strong>), that it uses to track HTTP sessions. Open the browser&#8217;s DevTools pane (Ctrl + Shift + C for Chrome, then go to <code>Application &gt; Cookies &gt; <a href="http://192.168.124.11:8080" class="bare">http://192.168.124.11:8080</a></code>) and find the <strong>JSESSIONID</strong> cookie value. Copy this value to the clipboard. TODO: Add a screenshot here&#8230;&#8203;.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
You cannot use a browser to test this scenario because there is no way to enable or simulate session stickiness. The browser will create a unique session ID for each of the nodes and you will not be able to visualize the replication and failover.
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Use the <code>curl</code> command to send requests to the application and increment the counter. Replace the <code>Cookie:</code> value with your own unique <strong>JSESSIONID</strong> value. TODO: Add curl output&#8230;&#8203;</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ curl -v -XPOST http://192.168.124.11:8080/cluster \
  --header "Cookie: JSESSIONID=HxM_z7c2tbtHdpzo0JnYkV5jNZWEfHvxrP0-bja-.eap1"</code></pre>
</div>
</div>
</li>
<li>
<p>The session ID created on <code>eap1</code> should have been replicated to all members of the cluster. To verify this behavior, press <code>Ctrl + C</code> in the <code>eap1</code> terminal window to stop the <code>eap1</code> node and eject it from the cluster. Observe the logs in the terminal window on <code>eap2</code>. The cluster has noticed that <code>eap1</code> is no longer available and it rebalances. TODO: Add logs here when you kill eap1&#8230;&#8203;</p>
</li>
<li>
<p>Use the <code>curl</code> command to send requests to <code>eap2</code>. Replace the <code>Cookie:</code> value with the same <strong>JSESSIONID</strong> value that you used for sending requests to <code>eap1</code>. TODO: Add curl output&#8230;&#8203;</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ curl -v -XPOST http://192.168.124.12:8080/cluster \
  --header "Cookie: JSESSIONID=HxM_z7c2tbtHdpzo0JnYkV5jNZWEfHvxrP0-bja-.eap1"</code></pre>
</div>
</div>
</li>
<li>
<p>Observe how the counter value is incremented, and not reset to 0. This is because the counter value (which has been stored in the HTTP session) has been replicated to <code>eap2</code>. Send a few more requests and notice the counter value is incremented by 1 for every request. TODO: curl output needed&#8230;&#8203;.</p>
</li>
<li>
<p>TODO: Test fail back. restart eap1 and kill eap2. see if counter value persists&#8230;&#8203;</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_troubleshooting_tips"><a class="anchor" href="#_troubleshooting_tips"></a>Troubleshooting Tips</h3>
<div class="ulist">
<ul>
<li>
<p>To troubleshoot if UDP multi-cast communication is happening correctly between your EAP nodes, use the <code>tcpdump</code> command on linux and snoop for traffic on port <code>45688</code>. You need to pass the correct network interface where traffic is to be monitored. In our case, RHEL 9 NIC called <code>enp1s0</code> which is used for both <code>public</code> and <code>private</code> IP address:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">[root@eap1 ~]$ tcpdump -i enp1s0 \
  udp port 45688 \
  -vvv
dropped privs to tcpdump
tcpdump: listening on enp1s0, link-type EN10MB (Ethernet), snapshot length 262144 bytes
10:36:03.614570 IP (tos 0x0, ttl 2, id 12241, offset 0, flags [DF], proto UDP (17), length 68)
    eap2.example.com.55200 &gt; 230.0.0.4.45688: [bad udp cksum 0x22fb -&gt; 0x20b6!] UDP, length 40
10:36:08.039372 IP (tos 0x0, ttl 2, id 45385, offset 0, flags [DF], proto UDP (17), length 104)
    eap1.example.com.55200 &gt; 230.0.0.4.45688: [bad udp cksum 0x231e -&gt; 0xeb2a!] UDP, length 76
10:36:09.216608 IP (tos 0x0, ttl 2, id 45629, offset 0, flags [DF], proto UDP (17), length 132)
    eap1.example.com.55200 &gt; 230.0.0.4.45688: [bad udp cksum 0x233a -&gt; 0xf835!] UDP, length 104
10:36:11.126320 IP (tos 0x0, ttl 2, id 46384, offset 0, flags [DF], proto UDP (17), length 132)
    eap1.example.com.55200 &gt; 230.0.0.4.45688: [bad udp cksum 0x233a -&gt; 0xf835!] UDP, length 104
10:36:11.616106 IP (tos 0x0, ttl 2, id 17726, offset 0, flags [DF], proto UDP (17), length 68)
    eap2.example.com.55200 &gt; 230.0.0.4.45688: [bad udp cksum 0x22fb -&gt; 0x20b6!] UDP, length 40</code></pre>
</div>
</div>
</li>
<li>
<p>Ensure that the firewall ports required for clustering to work correctly are opened on ALL the nodes of the cluster. Use the <code>firewall-cmd</code> to verify and change the firewall configuration</p>
</li>
<li>
<p>JBoss EAP ships with a multi-cast testing tool that you can use to verify is UDP multi-cast communication happens correctly. Take any two nodes in your cluster and run the following commands for sending and receiving. First, start the receiver. Run the command from the <code>$JBOSS_HOME/bin</code> folder.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">[jboss@eap1 bin]$ java -cp client/jboss-client.jar \
  org.jgroups.tests.McastReceiverTest \
  -mcast_addr 230.0.0.4 \
  -port 45700
Socket=/0:0:0:0:0:0:0:0:45700, bind interface=name:enp1s0 (enp1s0)
Socket=/0:0:0:0:0:0:0:0:45700, bind interface=name:lo (lo)
Socket=/0:0:0:0:0:0:0:0:45700, bind interface=name:lo (lo)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Similarly, start the sender on another node. The program will wait for input. Type some text and hit enter. If UDP multi-casting is working correctly, the text you typed should be echoed on the receiver node.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">[jboss@eap1 bin]$ java -cp client/jboss-client.jar \
  org.jgroups.tests.McastSenderTest \
  -mcast_addr 230.0.0.4 \
  -port 45700
Socket #1=/0:0:0:0:0:0:0:0:45700, ttl=32, bind interface=name:enp1s0 (enp1s0)
Socket #2=/0:0:0:0:0:0:0:0:45700, ttl=32, bind interface=name:lo (lo)
Socket #3=/0:0:0:0:0:0:0:0:45700, ttl=32, bind interface=name:lo (lo)
&gt; hello
&gt; world</code></pre>
</div>
</div>
</li>
</ul>
</div>
</div>
</div>
</div>
<nav class="pagination">
  <span class="prev"><a href="index.html">Clustering and High Availability</a></span>
  <span class="next"><a href="domain-cluster.html">Domain Mode Clustering</a></span>
</nav>
</article>
  </div>
</main>
</div>
<footer class="footer">
  <img src="../../../_/img/rhl-logo-red.png" height="40px" alt="Red Hat"  href="https://redhat.com" >
</footer><script id="site-script" src="../../../_/js/site.js" data-ui-root-path="../../../_"></script>
<script async src="../../../_/js/vendor/highlight.js"></script>
  </body>
</html>
