<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>JVM Configuration for JBoss EAP :: Red Hat JBoss EAP Administration II</title>
    <link rel="prev" href="domain-deployment.html">
    <link rel="next" href="../cluster/index.html">
    <meta name="generator" content="Antora 3.1.3">
    <link rel="stylesheet" href="../../../_/css/site.css">
    <script>var uiRootPath = '../../../_'</script>
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://www.redhat.com" target="_blank"><img
          src="../../../_/img/redhat-logo.png"
          height="40px"
          alt="Red Hat"
        /></a>
      <a
        class="navbar-item"
        style="font-size: 24px; color: white"
        href="../../.."
      >Red Hat JBoss EAP Administration II</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a
          class="navbar-item"
          href="https://github.com/RedHatQuickCourses/eap-admin2/issues"
          target="_blank"
        >Report Issues</a>
      </div>
    </div>
  </nav>
</header><div class="body">
<div class="nav-container" data-component="eap-admin2" data-version="8">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../index.html">Red Hat JBoss EAP Administration II</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../index.html">Home</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../adv-install/index.html">Advanced Installation</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../adv-install/response-files.html">Automated Installer Script</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../adv-install/adv-patching.html">Patches and Updates</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="index.html">JBoss EAP Domain Mode</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="domain-mode.html">JBoss EAP Domain Mode Configuration</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="domain-deployment.html">Deploying Applications</a>
  </li>
  <li class="nav-item is-current-page" data-depth="2">
    <a class="nav-link" href="jvm-config.html">JVM Configuration</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../cluster/index.html">Clustering and High Availability</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../cluster/standalone-cluster-udp.html">Standalone Mode Clustering (UDP)</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../cluster/standalone-cluster-tcp.html">Standalone Mode Clustering (TCP)</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../cluster/load-balancing.html">Load Balancing JBoss EAP Instances</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../security/index.html">Securing EAP</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../security/eap-security.html">Enabling or Disabling the EAP Management (Web) Console</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../security/tls-console.html">Enabling TLS/SSL in the EAP Web Console</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../security/vault.html">Secure Credential Storage Using Elytron Credential Store</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../security/sso-console.html">EAP Web Console Single Sign-On using OIDC</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Red Hat JBoss EAP Administration II</span>
    <span class="version">8</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <a class="title" href="../index.html">Red Hat JBoss EAP Administration II</a>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="../index.html">8</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../index.html">Red Hat JBoss EAP Administration II</a></li>
    <li><a href="index.html">JBoss EAP Domain Mode</a></li>
    <li><a href="jvm-config.html">JVM Configuration</a></li>
  </ul>
</nav>
</div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">JVM Configuration for JBoss EAP</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>JBoss EAP is written in Java, and runs on the Java Virtual Machine (JVM). An EAP administrator should be able to configure the settings of the underlying JVM to ensure optimal performance of applications deployed on JBoss EAP instances.</p>
</div>
<div class="paragraph">
<p>You can pass arguments to the <strong>java</strong> program to configure the JVM. There are hundreds of JVM options available to tune the behaviour of the JVM. The following list is a small subset of commonly tuned parameters for mostly backend services like application servers:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>-Xms</strong> is used to denote the minimum heap size. It must be less than or equal to the maximum
heap size.</p>
</li>
<li>
<p><strong>-Xmx</strong> defines the maximum heap size. If the application allocates memory greater than the
maximum heap size, then the JVM process triggers an out-of-memory (OOM) error.</p>
</li>
<li>
<p><strong>-XX:MaxMetaspaceSize</strong> defines the maximum size of the metaspace region.</p>
</li>
<li>
<p><strong>-XX:NewSize</strong> defines the size of the eden generation.</p>
</li>
<li>
<p><strong>-Xss</strong> or <strong>-XX:ThreadStackSize</strong> defines the size of each Java thread stack.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Consult the references section for more information on the JVM parameters and other aspects of JVM Tuning.</p>
</div>
<div class="paragraph">
<p>JVM configuration is different for JBoss EAP standalone mode and managed domains.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_jvm_configuration_in_standalone_mode"><a class="anchor" href="#_jvm_configuration_in_standalone_mode"></a>JVM Configuration in Standalone Mode</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The JVM memory settings for a standalone server are defined in the <code>EAP_HOME/bin/standalone.conf</code> file. The JVM settings defined in the <strong>JAVA_OPTS</strong> variable are passed to the JVM process that is running the standalone server.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">if [ "x$JAVA_OPTS" = "x" ]; then
   JAVA_OPTS="$JBOSS_JAVA_SIZING -Djava.net.preferIPv4Stack=true"
   JAVA_OPTS="$JAVA_OPTS -Djboss.modules.system.pkgs=$JBOSS_MODULES_SYSTEM_PKGS -Djava.awt.headless=true"
else
...
fi</code></pre>
</div>
</div>
<div class="paragraph">
<p>Within the double quotes of the <code>JAVA_OPTS</code> variable, you can edit, add, or delete any of the
settings regarding the JVM memory and garbage collection options for your standalone server.
Changes to the JVM settings in <code>standalone.conf</code> require a server restart.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_jvm_configuration_in_a_managed_domain"><a class="anchor" href="#_jvm_configuration_in_a_managed_domain"></a>JVM Configuration in a Managed Domain</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In the case of a managed domain, the host controller process starts EAP server instances as per the domain controller configuration policies. The JVM options for each individual server can be configured at three different
levels:</p>
</div>
<div class="dlist unordered stack">
<dl>
<dt>Host Controller Level</dt>
<dd>
<p>The <strong>&lt;jvm&gt;</strong> section within <code>host.xml</code></p>
</dd>
<dt>Server Group Level</dt>
<dd>
<p>The <strong>&lt;server-group&gt;</strong> section in <code>domain.xml</code></p>
</dd>
<dt>Server level</dt>
<dd>
<p>The <strong>&lt;server&gt;</strong> section within <code>host.xml</code></p>
</dd>
</dl>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Settings at the lower levels of the hierarchy override the settings at higher levels. For example, setting  JVM parameters at the individual server level will override any settings at the server group, or the host controller level.
</td>
</tr>
</table>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
There is a <code>EAP_HOME/bin/domain.conf</code> file in the same location as the <code>standalone.conf</code> file. The JVM memory options in <code>domain.conf</code> refer to the JVM settings for the Java process that is running the host controller, <strong>NOT</strong> the individual JBoss EAP servers within that host!
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You can configure the JVM settings for servers in a managed domain from the EAP web console at <code>Runtime &gt; Hosts</code> or at <code>Runtime &gt; Server Groups</code> sections.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/jvm-hosts.png" alt="jvm hosts">
</div>
<div class="title">Figure 1. Configure JVM at Host Level</div>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/jvm-server-groups.png" alt="jvm server groups">
</div>
<div class="title">Figure 2. Configure JVM at Server Group Level</div>
</div>
<div class="paragraph">
<p>You can also use the EAP CLI to configure the JVM settings. Consult the product documentation for the exact CLI commands.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_references"><a class="anchor" href="#_references"></a>References</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="https://access.redhat.com/documentation/en-us/red_hat_jboss_enterprise_application_platform/7.4/html-single/performance_tuning_guide/index#jvm_tuning">JVM Tuning</a></p>
</li>
<li>
<p><a href="https://access.redhat.com/documentation/en-us/red_hat_jboss_enterprise_application_platform/7.4/html/configuration_guide/configuring_jvm_settings#doc-wrapper">Configuring JVM Settings</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_exercise_jvm_configuration_in_a_managed_domain"><a class="anchor" href="#_exercise_jvm_configuration_in_a_managed_domain"></a>Exercise: JVM Configuration in a Managed Domain</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_pre_requisites"><a class="anchor" href="#_pre_requisites"></a>Pre-requisites</h3>
<div class="ulist">
<ul>
<li>
<p>You must have set up a managed domain of JBoss EAP servers and should have created a management user that can log in to the EAP web console or the EAP CLI.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_steps"><a class="anchor" href="#_steps"></a>Steps</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Log in to the EAP web console as a domain administrator user (If you completed the previous sections, then you should log in as the <code>eap-domain-admin</code> user).</p>
</li>
<li>
<p>Click <code>Runtime &gt; Hosts &gt; eap1</code>. Click the <code>View</code> button next to <code>eap1</code> to view the settings for the host.</p>
<div class="imageblock">
<div class="content">
<img src="_images/host-config-view.png" alt="host config view">
</div>
<div class="title">Figure 3. Configure Host Level Settings</div>
</div>
</li>
<li>
<p>In the <code>eap1</code> Host Controller page, click <code>JVMs</code> in the left sidebar.</p>
</li>
<li>
<p>There should a single <code>default</code> entry in the JVM list page. Click on <code>default</code> to view the settings. It has a default heap size of <code>64m</code>, maximum heap size of <code>256m</code>, and JVM option <code>-server, -XX:MetaspaceSize=96m, -XX:MaxMetaspaceSize=256m</code></p>
</li>
<li>
<p>Click <code>Add</code> to add a new JVM configuration. In the <code>Add JVM</code> dialog that pops up, enter <code>myeap1jvm</code> as the name and click <code>Add</code>.</p>
</li>
<li>
<p>Select the <code>myeap1jvm</code> and then click <code>Edit</code>. Enter <code>512m</code> in the <code>Max Heap Size</code> field and click <code>Save</code>.</p>
</li>
<li>
<p>Click the <code>Back</code> link to go back to the <code>Runtime</code> view. You need to restart the server instances running on the host <code>eap1</code> for your JVM changes to take effect. Click <code>Runtime &gt; Hosts&gt; eap1 &gt; server-one</code>. Click the <code>View</code> button next to <code>server-one</code> and then click <code>Restart</code> to restart the JVM process for <code>server-one</code>.</p>
</li>
<li>
<p>Wait for a few minutes while <code>server-one</code> is restarted. After the server is started (indicated by a green tick mark in the web console), log in to the <code>eap1</code> VM using SSH. Run the following command to check the startup parameters for <code>server-one</code></p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">[jboss@eap1 ~]$ ps ax | grep server-one
/usr/lib/jvm/java-17-openjdk-17.0.6.0.10-3.el9.x86_64/bin/java -D[Server:server-one] -D[pcid:175070110] -Xms1000m -Xmx1000m</code></pre>
</div>
</div>
</li>
<li>
<p>Some settings are inherited from the host level settings, but the <strong>-Xmx</strong> argument is <strong>1000m</strong> instead of the <strong>512m</strong> you configured at the host level. Can you guess why? [Hint: JVM settings at lower levels of the hierarchy override values set at higher levels].</p>
</li>
<li>
<p>Click <code>Runtime &gt; Server Groups &gt; main-server-group</code>. Click the <code>View</code> button next to <code>main-server-group</code> to open the Server Groups configuration page. Click <code>JVMs</code> in the left sidebar to view the JVM configuration for the server group. Click on <code>default</code> to view the default settings.</p>
</li>
<li>
<p>Observe that minimum and maximum heap size is set to <strong>1000m</strong>. These values override any settings at the host level.</p>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_optional_challenge_exercise"><a class="anchor" href="#_optional_challenge_exercise"></a>Optional Challenge Exercise</h2>
<div class="sectionbody">
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Edit the heap settings at the server group level. Restart the server instances and observe by running the <code>ps ax</code> command if your new settings are applied</p>
</li>
<li>
<p>Edit the JVM server configuration for one of the servers (server-one, server-two etc) and verify that values set at the individual server level override values from both the host and the server group level.</p>
</li>
<li>
<p>Try connecting to the domain controller using the EAP CLI and configure JVM settings using EAP CLI commands. Consult the product docs at <a href="https://access.redhat.com/documentation/en-us/red_hat_jboss_enterprise_application_platform/7.4/html/configuration_guide/configuring_jvm_settings#jvm_host_controller" class="bare">https://access.redhat.com/documentation/en-us/red_hat_jboss_enterprise_application_platform/7.4/html/configuration_guide/configuring_jvm_settings#jvm_host_controller</a> for examples. [Hint: Use tab-completion in the EAP CLI to explore the commands and operations available in a managed domain.]</p>
</li>
</ol>
</div>
</div>
</div>
<nav class="pagination">
  <span class="prev"><a href="domain-deployment.html">Deploying Applications</a></span>
  <span class="next"><a href="../cluster/index.html">Clustering and High Availability</a></span>
</nav>
</article>
  </div>
</main>
</div>
<footer class="footer">
  <img src="../../../_/img/rhl-logo-red.png" height="40px" alt="Red Hat"  href="https://redhat.com" >
</footer><script id="site-script" src="../../../_/js/site.js" data-ui-root-path="../../../_"></script>
<script async src="../../../_/js/vendor/highlight.js"></script>
  </body>
</html>
